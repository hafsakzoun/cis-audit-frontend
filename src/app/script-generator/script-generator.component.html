<div class="main-content">
  <div class="container-fluid">
    <div class="row justify-content-center">
      <div class="col-md-8">
        <!-- Script Generator Card -->
        <div class="card mb-4">
          <div class="card-header card-header-danger text-center">
            <h4 class="card-title">Script Generator</h4>
            <p class="card-category">Generate Audit script</p>
          </div>
          <div class="card-body">
            <form>
              <!-- Row 1: Category + Solution -->
              <div class="row">
                <div class="col-md-6">
                  <mat-form-field appearance="fill" class="example-full-width" floatLabel="always">
                    <mat-label>Category</mat-label>
                    <mat-select
                      [(value)]="selectedCategory"
                      (selectionChange)="onCategoryChange()"
                      [disabled]="isLoadingCategories"
                    >
                      <mat-option *ngIf="isLoadingCategories" disabled>Loading...</mat-option>
                      <mat-option *ngFor="let cat of categories" [value]="cat">{{ cat }}</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
                <div class="col-md-6">
                  <mat-form-field appearance="fill" class="example-full-width" floatLabel="always">
                    <mat-label>Solution</mat-label>
                    <mat-select
                      [(value)]="selectedSolution"
                      (selectionChange)="onSolutionChange()"
                      [disabled]="!selectedCategory || isLoadingSolutions"
                    >
                      <mat-option *ngIf="isLoadingSolutions" disabled>Loading...</mat-option>
                      <mat-option *ngFor="let sol of solutions" [value]="sol">{{ sol }}</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
              </div>

              <!-- Row 2: Benchmark Version + Solution Version -->
              <div class="row">
                <div class="col-md-6">
                  <mat-form-field appearance="fill" class="example-full-width" floatLabel="always">
                    <mat-label>Benchmark Version</mat-label>
                    <mat-select
                      [(value)]="selectedBenchmarkVersion"
                      [disabled]="!selectedSolution || isLoadingBenchmarkVersions"
                    >
                      <mat-option *ngIf="isLoadingBenchmarkVersions" disabled>Loading...</mat-option>
                      <mat-option *ngFor="let version of benchmarkVersions" [value]="version">{{ version }}</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
                <div class="col-md-6">
                  <mat-form-field appearance="fill" class="example-full-width" floatLabel="always">
                    <mat-label>Solution Version</mat-label>
                    <mat-select
                      [(value)]="selectedSolutionVersion"
                      [disabled]="!selectedSolution || isLoadingSolutionVersions"
                    >
                      <mat-option *ngIf="isLoadingSolutionVersions" disabled>Loading...</mat-option>
                      <mat-option *ngFor="let version of solutionVersions" [value]="version">{{ version }}</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
              </div>

              <!-- Audit Notes -->
              <div class="row">
                <div class="col-md-12">
                  <mat-form-field appearance="fill" class="example-full-width" floatLabel="always">
                    <mat-label>Audit Notes</mat-label>
                    <textarea matInput placeholder="Describe key observations, issues, or remarks here..."></textarea>
                  </mat-form-field>
                </div>
              </div>

              <!-- Generate Button -->
              <button
                mat-raised-button
                color="warn"
                type="button"
                class="btn pull-right"
                [disabled]="!selectedBenchmarkVersion || !selectedSolutionVersion || isGeneratingScript"
                [ngClass]="{ 'btn-danger': selectedBenchmarkVersion && selectedSolutionVersion }"
                (click)="generateAuditScript()"
              >
                {{ isGeneratingScript ? 'Generating...' : 'Generate Audit Script' }}
              </button>
              <div class="clearfix"></div>
            </form>
          </div>
        </div>

        <!-- Script Result Output -->
        <div class="text-center mb-4">
          <mat-progress-spinner *ngIf="isGeneratingScript" diameter="25" mode="indeterminate"></mat-progress-spinner>

          <div *ngIf="numberOfRules !== null && !isGeneratingScript" class="text-success mb-2">
            âœ… {{ numberOfRules }} rules generated successfully!
          </div>

          <div *ngIf="generationResult && !isGeneratingScript">
            <mat-form-field appearance="outline" class="w-100">
              <textarea matInput [value]="generationResult" rows="10" readonly></textarea>
            </mat-form-field>
          </div>
        </div>

        <!-- Audit Toolkit -->
        <div *ngIf="generationResult && !isGeneratingScript" class="card card-profile">
          <div class="card-body text-center">
            <h6 class="card-category text-gray">Audit Toolkit</h6>
            <h4 class="card-title">Automation Helper</h4>
            <p class="card-description">
              Download or share the script you generated.
            </p>

            <!-- Buttons -->
            <button
              mat-raised-button
              color="primary"
              class="btn btn-round mb-2 mr-2"
              (click)="downloadScript()"
            >
              Download Script
            </button>

            <button
              mat-raised-button
              color="accent"
              class="btn btn-round mb-2"
              (click)="shareScriptViaEmail()"
            >
              Share via Email
            </button>

            <button mat-raised-button color="accent" class="btn btn-accent btn-round mt-2">
              View Summary
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
